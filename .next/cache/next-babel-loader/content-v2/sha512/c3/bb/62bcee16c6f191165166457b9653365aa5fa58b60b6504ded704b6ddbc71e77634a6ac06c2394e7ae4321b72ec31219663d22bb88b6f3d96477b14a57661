{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport React, { useEffect, useState } from \"react\";\nimport Admin from \"../../../../layouts/Admin\";\nimport { useTranslation } from \"../../../../Utility/Translations/useTranslation\";\nimport * as yup from \"yup\";\nimport { Form, Formik } from \"formik\";\nimport SuiButton from \"../../../../components/SuiButton\";\nimport { toast } from \"react-toastify\";\nimport UserService from \"../../../../Services/UserService\";\nimport { MenuProps } from \"./utils\";\nimport { ArrowBack } from \"@material-ui/icons\";\nimport Card from \"../../../../components/Card/Card\";\nimport { Box, CardActions, Grid, MenuItem, TextField, Typography, Select, ListItemIcon, Checkbox, ListItemText } from \"@material-ui/core\";\nimport GridItem from \"../../../../components/Grid/GridItem\";\n\nvar UserDetails = function UserDetails(_ref) {\n  var isCreate = _ref.isCreate,\n      details = _ref.details,\n      handleBack = _ref.handleBack,\n      activateEdit = _ref.activateEdit,\n      isEditable = _ref.isEditable;\n\n  var _React$useState = React.useState([]),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      assignedRoles = _React$useState2[0],\n      setAssignedRoles = _React$useState2[1];\n\n  var _React$useState3 = React.useState([]),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      unassignedRoles = _React$useState4[0],\n      setUnAssignedRoles = _React$useState4[1];\n\n  var _React$useState5 = React.useState([]),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      permissions = _React$useState6[0],\n      setPermissions = _React$useState6[1];\n\n  var _React$useState7 = React.useState([]),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      unassignedPermissions = _React$useState8[0],\n      setUnAssignedPermissions = _React$useState8[1];\n\n  var _React$useState9 = React.useState(0),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      role = _React$useState10[0],\n      setRole = _React$useState10[1];\n\n  var _React$useState11 = React.useState(0),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      assignedRole = _React$useState12[0],\n      setAssignedRole = _React$useState12[1];\n\n  var _React$useState13 = React.useState([]),\n      _React$useState14 = _slicedToArray(_React$useState13, 2),\n      selected = _React$useState14[0],\n      setSelected = _React$useState14[1];\n\n  var _React$useState15 = React.useState([]),\n      _React$useState16 = _slicedToArray(_React$useState15, 2),\n      selectedUnAssigned = _React$useState16[0],\n      setSelectedUnAssigned = _React$useState16[1];\n\n  var _useState = useState(details),\n      User = _useState[0],\n      setDetails = _useState[1];\n\n  var _useTranslation = useTranslation(),\n      translate = _useTranslation.translate;\n\n  var UserSchema = yup.object({\n    email: yup.string(translate(\"الإيميل\")).required(translate(\"Field is required\")),\n    password: yup.string(translate(\"كلمة السر\")).required(translate(\"Field is required\"))\n  });\n  var initialValues = isCreate ? {\n    email: User === null || User === void 0 ? void 0 : User.email\n  } : {\n    id: User.id,\n    email: User.email\n  };\n  /************************* Handle Edit User ************/\n\n  var handleEditUser = function handleEditUser(event) {\n    event.preventDefault();\n    activateEdit();\n  };\n  /************************* Handle Add Description ************/\n\n\n  var validationSchema = yup.object({\n    email: yup.string(translate(\"English Name\")).required(translate(\"Field is required\")),\n    password: yup.string(translate(\"Arabic Name\")).required(translate(\"Field is required\"))\n  });\n  /*************** Handle End Add Description For User ******/\n\n  var _useState2 = useState(\"\"),\n      errorPercentageMsg = _useState2[0],\n      setErrorPercentageMsg = _useState2[1];\n\n  var submitForm = function submitForm(values, setSubmitting) {\n    if (isCreate) {\n      var payload = {\n        email: values.email,\n        password: values.password\n      };\n      console.clear();\n      UserService.Add(payload).then(function (response) {\n        if (response.success) {\n          toast.success(\"تمت إضافة المستخدم بنجاح\");\n          handleBack();\n        } else {\n          console.log(response.error);\n          toast.error(response.error.message);\n        }\n      }).catch(function (error) {\n        console.log(error.message);\n        toast.error(error.message);\n        throw new Error(error);\n      });\n    } else {\n      var _payload = {\n        user_id: User.id,\n        // email: values.email,\n        password: values.password\n      };\n      UserService.Edit(_payload).then(function (response) {\n        if (response.success) {\n          toast.success(\"تم تعديل معلومات المستخدم بنجاح\");\n        } else {\n          console.log(response.error);\n          toast.error(response.error.message);\n        }\n      }).catch(function (error) {\n        console.log(error.message);\n        toast.error(error.message);\n        throw new Error(error);\n      });\n    }\n\n    setSubmitting(false);\n  };\n\n  var getData = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var user, permissions;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setAssignedRoles([]);\n              setUnAssignedRoles([]);\n              setUnAssignedPermissions([]);\n              setPermissions([]);\n              setSelected([]);\n              setSelectedUnAssigned([]);\n              user = null;\n              permissions = [];\n              _context.next = 10;\n              return UserService.GetPermissions().then(function (response) {\n                permissions = response.result;\n              }).catch(function (e) {\n                throw new Error(e);\n              });\n\n            case 10:\n              _context.next = 12;\n              return UserService.Get(User.id.toString()).then(function (response) {\n                user = response.result;\n                setDetails(user);\n                setAssignedRoles(user.roles);\n              }).catch(function (e) {\n                throw new Error(e);\n              });\n\n            case 12:\n              _context.next = 14;\n              return UserService.GetRoles().then(function (response) {\n                var _user, _user$user_permission;\n\n                var roles = response.result.filter(function (e) {\n                  return !user.roles.map(function (c) {\n                    return c.id;\n                  }).includes(e.id);\n                });\n                setUnAssignedRoles(roles);\n                var userPerm = ((_user = user) === null || _user === void 0 ? void 0 : (_user$user_permission = _user.user_permissions) === null || _user$user_permission === void 0 ? void 0 : _user$user_permission.map(function (e) {\n                  return e.permission;\n                })) || [];\n                var unAssignedPerms = permissions.filter(function (e) {\n                  return !userPerm.map(function (c) {\n                    return c.id;\n                  }).includes(e.id);\n                });\n                setPermissions(userPerm);\n                setUnAssignedPermissions(unAssignedPerms);\n              }).catch(function (e) {\n                throw new Error(e);\n              });\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function getData() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    getData();\n  }, []);\n\n  var assignRole = function assignRole() {\n    if (!!role) {\n      var payload = {\n        user_id: User.id,\n        role_id: role\n      };\n      UserService.AssignUserToRole(payload).then(function (response) {\n        if (response.success) {\n          getData();\n          toast.success(\"تم إسناد الدور بنجاح\");\n        } else {\n          console.log(response.error);\n          toast.error(response.error.message);\n        }\n      }).catch(function (error) {\n        console.log(error.message);\n        toast.error(error.message);\n        throw new Error(error);\n      });\n    } else {\n      toast.error(\"الرجاء اختيار دور\");\n    }\n  };\n\n  var unAssignRole = function unAssignRole() {\n    if (!!assignedRole) {\n      var payload = {\n        user_id: User.id,\n        role_id: assignedRole\n      };\n      UserService.RevokeRole(payload).then(function (response) {\n        if (response.success) {\n          getData();\n          toast.success(\"تم إلغاء إسناد الدور بنجاح\");\n        } else {\n          toast.error(response.error.message);\n        }\n      }).catch(function (error) {\n        throw new Error(error);\n      });\n    } else {\n      toast.error(\"الرجاء اختيار دور\");\n    }\n  };\n\n  var changeRole = function changeRole(value) {\n    setRole(value);\n    UserService.GetPermissions(value).then(function (response) {\n      setPermissions(response.result);\n    }).catch(function (e) {\n      throw new Error(e);\n    });\n  };\n\n  var changeAssignedRole = function changeAssignedRole(value) {\n    setAssignedRole(value);\n  };\n\n  var submitPermission = function submitPermission() {\n    if (selectedUnAssigned.length > 0) {\n      var trues = selectedUnAssigned.map(function (e) {\n        var payload = {\n          user_id: User.id,\n          permission_id: e\n        };\n        UserService.AssignUserToPermission(payload).then(function (response) {\n          console.clear();\n\n          if (response.success) {\n            console.log(response);\n            return e;\n          } else {\n            console.log(response.error); // toast.error(response.error.message);\n          }\n        }).catch(function (error) {\n          console.log(error.message);\n          toast.error(error.message);\n          throw new Error(error);\n        });\n      });\n\n      if (selectedUnAssigned.length > 0 && trues.length == selectedUnAssigned.length) {\n        getData();\n        toast.success(\"تم إسناد الصلاحيات بنجاح\");\n      }\n    } else {\n      toast.error(\"الرجاء اختيار صلاحية واحدة على الأقل\");\n    }\n  };\n\n  var revokePermission = function revokePermission() {\n    if (selected.length > 0) {\n      var trues = selected.map(function (e) {\n        var payload = {\n          user_id: User.id,\n          permission_id: e\n        };\n        UserService.RevokePermission(payload).then(function (response) {\n          if (response.success) {\n            console.log(response);\n            return e;\n          } else {}\n        }).catch(function (error) {\n          toast.error(error.message);\n          throw new Error(error);\n        });\n      });\n\n      if (selected.length > 0 && trues.length == selected.length) {\n        getData();\n        toast.success(\"تم إلغاء إسناد الصلاحيات بنجاح\");\n      }\n    } else {\n      toast.error(\"الرجاء اختيار صلاحية واحدة على الأقل\");\n    }\n  };\n\n  var handleChange = function handleChange(event) {\n    var value = event.target.value;\n    console.clear();\n    console.log(value);\n    setSelected(value);\n  };\n\n  var handleChangeUnAssign = function handleChangeUnAssign(event) {\n    var value = event.target.value;\n    console.clear();\n    console.log(value);\n    setSelectedUnAssigned(value);\n  };\n\n  return /*#__PURE__*/_jsx(Grid, {\n    container: true,\n    md: 12,\n    sm: 12,\n    children: /*#__PURE__*/_jsxs(Grid, {\n      md: 12,\n      sm: 12,\n      xs: 12,\n      children: [/*#__PURE__*/_jsx(Card, {\n        style: {\n          padding: \"1em 4em\",\n          margin: \"5px 0px\"\n        },\n        children: /*#__PURE__*/_jsxs(Grid, {\n          container: true,\n          children: [/*#__PURE__*/_jsxs(GridItem, {\n            item: true,\n            md: 9,\n            xs: 12,\n            sm: 12,\n            children: [/*#__PURE__*/_jsx(Typography, {\n              variant: \"h5\",\n              component: \"div\"\n            }), /*#__PURE__*/_jsx(Typography, {\n              sx: {\n                mb: 1.5\n              },\n              color: \"text.secondary\",\n              children: translate(\"تفاصيل المستخدم\")\n            })]\n          }), /*#__PURE__*/_jsx(GridItem, {\n            md: 3,\n            xs: 12,\n            sm: 12,\n            children: /*#__PURE__*/_jsxs(SuiButton, {\n              onClick: function onClick() {\n                return handleBack();\n              },\n              color: \"warning\",\n              children: [/*#__PURE__*/_jsx(ArrowBack, {}), translate(\"Back To Previous Page\")]\n            })\n          })]\n        })\n      }), /*#__PURE__*/_jsx(Card, {\n        style: {\n          padding: \"3em 3em\",\n          margin: \"5px 0px\"\n        },\n        children: /*#__PURE__*/_jsx(Formik, {\n          enableReinitialize: true,\n          initialValues: initialValues,\n          validationSchema: validationSchema,\n          onSubmit: function onSubmit(values, _ref3) {\n            var setSubmitting = _ref3.setSubmitting;\n            submitForm(values, setSubmitting); // console.clear();\n            // console.log(values);\n          },\n          children: function children(formik) {\n            var values = formik.values,\n                handleChange = formik.handleChange,\n                handleSubmit = formik.handleSubmit,\n                errors = formik.errors,\n                touched = formik.touched,\n                handleBlur = formik.handleBlur,\n                isSubmitting = formik.isSubmitting,\n                isValid = formik.isValid,\n                dirty = formik.dirty,\n                setFieldValue = formik.setFieldValue;\n            return /*#__PURE__*/_jsxs(Form, {\n              onSubmit: handleSubmit,\n              children: [/*#__PURE__*/_jsxs(Grid, {\n                container: true,\n                md: 12,\n                xs: 12,\n                style: {\n                  margin: \"1em 0em\"\n                },\n                children: [/*#__PURE__*/_jsx(Grid, {\n                  container: true,\n                  md: 12,\n                  style: {\n                    margin: \"1em 0em\",\n                    color: \"red\",\n                    display: errors && // 👈 null and undefined check\n                    Object.keys(errors).length === 0 && Object.getPrototypeOf(errors) === Object.prototype ? \"none\" : \"block\"\n                  }\n                }), /*#__PURE__*/_jsx(Grid, {\n                  item: true,\n                  xs: 3,\n                  md: 3,\n                  children: /*#__PURE__*/_jsx(GridItem, {\n                    children: /*#__PURE__*/_jsx(TextField, {\n                      disabled: isEditable,\n                      onChange: handleChange,\n                      variant: \"outlined\",\n                      size: \"small\",\n                      type: \"text\",\n                      id: \"email\",\n                      name: \"email\",\n                      value: values.email,\n                      onBlur: handleBlur,\n                      error: Boolean(touched.email && errors.email),\n                      helperText: touched.email && errors.email,\n                      placeholder: translate(\"الإيميل\"),\n                      label: translate(\"الإيميل\"),\n                      fullWidth: true\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(Grid, {\n                  item: true,\n                  xs: 3,\n                  md: 3,\n                  children: /*#__PURE__*/_jsx(GridItem, {\n                    children: /*#__PURE__*/_jsx(TextField, {\n                      onChange: handleChange,\n                      variant: \"outlined\",\n                      size: \"small\",\n                      type: \"password\",\n                      id: \"password\",\n                      name: \"password\",\n                      value: values.password,\n                      onBlur: handleBlur,\n                      error: Boolean(touched.password && errors.password),\n                      helperText: touched.password && errors.password,\n                      placeholder: translate(\"كلمة السر\"),\n                      label: translate(\"كلمة السر\"),\n                      fullWidth: true\n                    })\n                  })\n                })]\n              }), /*#__PURE__*/_jsx(Box, {\n                mt: 4,\n                mb: 1,\n                style: {\n                  display: \"flex\",\n                  justifyContent: \"space-between\"\n                },\n                children: isSubmitting ? /*#__PURE__*/_jsx(SuiButton, {\n                  type: \"button\",\n                  disabled: true,\n                  variant: \"gradient\",\n                  color: \"info\",\n                  children: translate(\"Processing ...\")\n                }) : /*#__PURE__*/_jsx(SuiButton, {\n                  style: {\n                    color: \"rgb(255, 255, 255)\",\n                    background: \"rgb(23, 193, 232)\"\n                  },\n                  disabled: !isValid && isSubmitting,\n                  type: \"submit\",\n                  children: translate(\"Save\")\n                })\n              })]\n            });\n          }\n        })\n      }), isEditable && /*#__PURE__*/_jsx(Card, {\n        style: {\n          padding: \"3em 3em\",\n          margin: \"5px 0px\"\n        },\n        children: /*#__PURE__*/_jsxs(Grid, {\n          container: true,\n          md: 12,\n          children: [/*#__PURE__*/_jsx(GridItem, {\n            item: true,\n            md: 3,\n            xs: 12,\n            sm: 6,\n            children: /*#__PURE__*/_jsx(Typography, {\n              variant: \"h5\",\n              component: \"div\",\n              children: \"\\u0627\\u0644\\u0623\\u062F\\u0648\\u0627\\u0631 \\u063A\\u064A\\u0631 \\u0627\\u0644\\u0645\\u0633\\u0646\\u062F\\u0629\"\n            })\n          }), /*#__PURE__*/_jsx(GridItem, {\n            item: true,\n            md: 3,\n            xs: 12,\n            sm: 6,\n            children: /*#__PURE__*/_jsx(Typography, {\n              variant: \"h5\",\n              component: \"div\",\n              children: \"\\u0627\\u0644\\u0623\\u062F\\u0648\\u0627\\u0631 \\u0627\\u0644\\u0645\\u0633\\u0646\\u062F\\u0629\"\n            })\n          }), /*#__PURE__*/_jsx(GridItem, {\n            item: true,\n            md: 3,\n            xs: 12,\n            sm: 6,\n            children: /*#__PURE__*/_jsx(Typography, {\n              variant: \"h5\",\n              component: \"div\",\n              children: \"\\u0627\\u0644\\u0635\\u0644\\u0627\\u062D\\u064A\\u0627\\u062A \\u063A\\u064A\\u0631 \\u0627\\u0644\\u0645\\u0633\\u0646\\u062F\\u0629\"\n            })\n          }), /*#__PURE__*/_jsx(GridItem, {\n            item: true,\n            md: 3,\n            xs: 12,\n            sm: 6,\n            children: /*#__PURE__*/_jsx(Typography, {\n              variant: \"h5\",\n              component: \"div\",\n              children: \"\\u0627\\u0644\\u0635\\u0644\\u0627\\u062D\\u064A\\u0627\\u062A \\u0627\\u0644\\u0645\\u0633\\u0646\\u062F\\u0629\"\n            })\n          }), /*#__PURE__*/_jsxs(GridItem, {\n            item: true,\n            md: 3,\n            xs: 12,\n            sm: 12,\n            children: [/*#__PURE__*/_jsx(TextField, {\n              id: \"outlined-select-currency-native\",\n              select: true,\n              label: \"\",\n              defaultValue: \"\",\n              onChange: function onChange(e) {\n                return changeRole(e.target.value);\n              },\n              helperText: \"\\u0627\\u0644\\u0631\\u062C\\u0627\\u0621 \\u0627\\u062E\\u062A\\u064A\\u0627\\u0631 \\u062F\\u0648\\u0631 \\u0644\\u0647\\u0630\\u0627 \\u0627\\u0644\\u0645\\u0633\\u062A\\u062E\\u062F\\u0645\",\n              children: unassignedRoles.map(function (option) {\n                return /*#__PURE__*/_jsx(\"option\", {\n                  value: option.id,\n                  children: option.name\n                }, option.id);\n              })\n            }), /*#__PURE__*/_jsx(SuiButton, {\n              style: {\n                color: \"rgb(255, 255, 255)\",\n                background: \"rgb(23, 193, 232)\",\n                margin: \"0 10px 0 10px\"\n              },\n              onClick: assignRole,\n              children: translate(\"إسناد\")\n            })]\n          }), /*#__PURE__*/_jsxs(GridItem, {\n            item: true,\n            md: 3,\n            xs: 12,\n            sm: 12,\n            children: [/*#__PURE__*/_jsx(TextField, {\n              id: \"outlined-select-currency-native\",\n              select: true,\n              label: \"\",\n              defaultValue: \"\",\n              onChange: function onChange(e) {\n                return changeAssignedRole(e.target.value);\n              },\n              helperText: \"\\u0627\\u0644\\u0631\\u062C\\u0627\\u0621 \\u0627\\u062E\\u062A\\u064A\\u0627\\u0631 \\u062F\\u0648\\u0631 \\u0644\\u0647\\u0630\\u0627 \\u0627\\u0644\\u0645\\u0633\\u062A\\u062E\\u062F\\u0645\",\n              children: assignedRoles.map(function (option) {\n                return /*#__PURE__*/_jsx(\"option\", {\n                  value: option.id,\n                  children: option.name\n                }, option.id);\n              })\n            }), /*#__PURE__*/_jsx(SuiButton, {\n              style: {\n                color: \"rgb(255, 255, 255)\",\n                background: \"rgb(23, 193, 232)\",\n                margin: \"0 10px 0 10px\"\n              },\n              onClick: unAssignRole,\n              children: translate(\"إلغاء الإسناد\")\n            })]\n          }), /*#__PURE__*/_jsxs(GridItem, {\n            item: true,\n            md: 3,\n            xs: 12,\n            sm: 12,\n            children: [/*#__PURE__*/_jsx(Select, {\n              labelId: \"mutiple-select-label\",\n              multiple: true,\n              value: selectedUnAssigned,\n              onChange: handleChangeUnAssign,\n              renderValue: function renderValue(selected) {\n                return \"\".concat(selected.map(function (e) {\n                  return e.name;\n                }).length, \" \\u0635\\u0644\\u0627\\u062D\\u064A\\u0629 \\u0645\\u062E\\u062A\\u0627\\u0631\\u0629\");\n              },\n              MenuProps: MenuProps,\n              children: unassignedPermissions.map(function (option) {\n                return /*#__PURE__*/_jsxs(MenuItem, {\n                  value: option.id,\n                  children: [/*#__PURE__*/_jsx(ListItemIcon, {\n                    children: /*#__PURE__*/_jsx(Checkbox, {\n                      checked: selectedUnAssigned.indexOf(option.id) > -1\n                    })\n                  }), /*#__PURE__*/_jsx(ListItemText, {\n                    primary: option.name\n                  })]\n                }, option.id);\n              })\n            }), /*#__PURE__*/_jsx(SuiButton, {\n              style: {\n                color: \"rgb(255, 255, 255)\",\n                background: \"rgb(23, 193, 232)\",\n                margin: \"0 10px 0 10px\"\n              },\n              onClick: submitPermission,\n              children: translate(\"إسناد\")\n            })]\n          }), /*#__PURE__*/_jsxs(GridItem, {\n            item: true,\n            md: 3,\n            xs: 12,\n            sm: 12,\n            children: [/*#__PURE__*/_jsx(Select, {\n              labelId: \"mutiple-select-label\",\n              multiple: true,\n              value: selected,\n              onChange: handleChange,\n              renderValue: function renderValue(selected) {\n                return \"\".concat(selected.map(function (e) {\n                  return e.name;\n                }).length, \" \\u0635\\u0644\\u0627\\u062D\\u064A\\u0629 \\u0645\\u062E\\u062A\\u0627\\u0631\\u0629\");\n              },\n              MenuProps: MenuProps,\n              children: permissions.map(function (option) {\n                return /*#__PURE__*/_jsxs(MenuItem, {\n                  value: option.id,\n                  children: [/*#__PURE__*/_jsx(ListItemIcon, {\n                    children: /*#__PURE__*/_jsx(Checkbox, {\n                      checked: selected.indexOf(option.id) > -1\n                    })\n                  }), /*#__PURE__*/_jsx(ListItemText, {\n                    primary: option.name\n                  })]\n                }, option.id);\n              })\n            }), /*#__PURE__*/_jsx(SuiButton, {\n              style: {\n                color: \"rgb(255, 255, 255)\",\n                background: \"rgb(23, 193, 232)\",\n                margin: \"0 10px 0 10px\"\n              },\n              onClick: revokePermission,\n              children: translate(\"إلغاء الإسناد\")\n            })]\n          })]\n        })\n      }), /*#__PURE__*/_jsx(CardActions, {})]\n    })\n  });\n};\n\nUserDetails.layout = Admin;\nUserDetails.auth = false;\nexport default UserDetails;","map":null,"metadata":{},"sourceType":"module"}