{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useEffect, useState } from \"react\";\nimport { Formik, Form } from \"formik\";\nimport * as Yup from \"yup\";\nimport { useRouter } from \"next/router\"; // Authentication layout components\n\nimport CoverLayout from \"../../../components/CoverLayout\";\nimport { Box, Typography, TextField, Select, MenuItem } from \"@material-ui/core\";\nimport { Switch } from \"@material-ui/core\";\nimport SuiButton from \"../../../components/SuiButton\";\nimport \"../../../assets/css/main.css\";\nimport { selectSessionKey, useAppDispatch, useAppSelector, setSessionKey, updateProfile, selectUserProfile } from \"../../../redux\";\nimport LoginService from \"../../../Services/LoginService\";\nimport { useTranslation } from \"../../../Utility/Translations/useTranslation\";\nimport { toast } from \"react-toastify\"; // Images\n\nconst bg7 = require(\"./../../../assets/img/curved-images/HIAST.jpg\");\n\nfunction SignIn(props) {\n  const {\n    translate\n  } = useTranslation();\n  const {\n    locale\n  } = useRouter();\n  const dispatch = useAppDispatch();\n  const {\n    0: rememberMe,\n    1: setRememberMe\n  } = useState(true);\n  const {\n    0: _currentSessionKey,\n    1: setCurrentSessionKey\n  } = useState(\"\");\n  const sessionKey = useAppSelector(selectSessionKey);\n  const userProfile = useAppSelector(selectUserProfile);\n  useEffect(() => {\n    if (false) {\n      // Perform localStorage action\n      let profile = JSON.parse(localStorage.getItem(\"logged_in_profile\"));\n      let key = localStorage.getItem(\"sa_access_token\");\n\n      if (!!key && key !== \"undefined\") {\n        // dispatch(setSessionKey(key));\n        router.push(\"/students_affairs/dashboard\");\n      }\n    }\n  }, []);\n  const {\n    0: isLoading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: years,\n    1: setYears\n  } = useState([]);\n  const {\n    0: selectedYear,\n    1: setSelectedYear\n  } = useState(\"\");\n  const initialValues = {\n    username: \"\",\n    // email: \"\",\n    password: \"\",\n    rememberMe: false\n  };\n\n  const handleSetRememberMe = () => setRememberMe(!rememberMe);\n\n  const router = useRouter();\n\n  async function fetchApi() {\n    let data = await LoginService.GetYears();\n    return data;\n  }\n\n  const handleChangeYear = event => {\n    setSelectedYear(event.target.value);\n  };\n\n  useEffect(() => {\n    setLoading(true);\n  }, []);\n  const SignInSchema = Yup.object().shape({\n    username: Yup.string().required(translate(\"{0} is required\", \"Username\")),\n    // .required(\"Email is required\"),\n    // email: Yup.string()\n    //   .email(\"Must be a valid email\")\n    //   .required(\"Email is required\"),\n    password: Yup.string().required(translate(\"{0} is required\", \"Password\")).min(4, translate(\"Password is too short - should be {0} chars minimum\", \"4\", false))\n  });\n\n  const submitForm = async (values, setSubmitting) => {\n    LoginService.Login({\n      email: values.username,\n      password: values.password\n    }).then(response => {\n      if (response.success) {\n        localStorage.setItem(\"sa_access_token\", response.result.token);\n        localStorage.setItem(\"logged_in_profile\", JSON.stringify(response.result));\n        dispatch(updateProfile(response.result));\n        dispatch(setSessionKey(response.result.token));\n        router.push(\"/students_affairs/dashboard\");\n      } else {\n        toast.error(response);\n        setSubmitting(false);\n      }\n    }).catch(e => {\n      throw new Error(e);\n    });\n  };\n\n  return !sessionKey && /*#__PURE__*/_jsx(CoverLayout, {\n    title: translate(\"Welcome\"),\n    description: translate(\"Enter your credentials to sign in\"),\n    image: bg7,\n    children: /*#__PURE__*/_jsx(Box, {\n      children: /*#__PURE__*/_jsx(Formik, {\n        initialValues: initialValues,\n        validationSchema: SignInSchema,\n        onSubmit: (values, {\n          setSubmitting\n        }) => {\n          submitForm(values, setSubmitting);\n        },\n        children: formik => {\n          const {\n            values,\n            handleChange,\n            handleSubmit,\n            errors,\n            touched,\n            handleBlur,\n            isSubmitting,\n            isValid,\n            dirty\n          } = formik;\n          return /*#__PURE__*/_jsxs(Form, {\n            children: [!isLoading && /*#__PURE__*/_jsxs(Box, {\n              mb: 2,\n              children: [/*#__PURE__*/_jsx(Box, {\n                mb: 1,\n                ml: 0.5,\n                children: /*#__PURE__*/_jsx(Typography, {\n                  component: \"label\",\n                  variant: \"caption\",\n                  children: \"Year\"\n                })\n              }), /*#__PURE__*/_jsx(Select, {\n                labelId: \"demo-simple-select-label\",\n                id: \"demo-simple-select\",\n                value: selectedYear,\n                label: \"Year\",\n                onChange: handleChangeYear,\n                children: years.map((item, ind) => {\n                  return /*#__PURE__*/_jsx(MenuItem, {\n                    value: item.id,\n                    children: item.year\n                  });\n                })\n              })]\n            }), /*#__PURE__*/_jsxs(Box, {\n              mb: 2,\n              children: [/*#__PURE__*/_jsx(Box, {\n                mb: 1,\n                ml: 0.5,\n                children: /*#__PURE__*/_jsx(Typography, {\n                  component: \"label\",\n                  variant: \"caption\",\n                  children: translate(\"Username\")\n                })\n              }), /*#__PURE__*/_jsx(TextField, {\n                onChange: handleChange,\n                variant: \"outlined\",\n                size: \"small\",\n                type: \"text\",\n                id: \"username\",\n                name: \"username\",\n                value: values.username,\n                onBlur: handleBlur,\n                error: Boolean(touched.username && errors.username),\n                helperText: touched.username && errors.username,\n                placeholder: translate(\"Username\"),\n                fullWidth: true\n              })]\n            }), /*#__PURE__*/_jsxs(Box, {\n              mb: 2,\n              children: [/*#__PURE__*/_jsx(Box, {\n                mb: 1,\n                ml: 0.5,\n                children: /*#__PURE__*/_jsx(Typography, {\n                  component: \"label\",\n                  variant: \"caption\",\n                  children: translate(\"Password\")\n                })\n              }), /*#__PURE__*/_jsx(TextField, {\n                id: \"password\",\n                name: \"password\",\n                type: \"password\",\n                variant: \"outlined\",\n                size: \"small\",\n                placeholder: translate(\"Password\"),\n                onChange: handleChange,\n                onBlur: handleBlur,\n                error: Boolean(errors.password && touched.password),\n                helperText: touched.password && errors.password,\n                fullWidth: true\n              })]\n            }), /*#__PURE__*/_jsxs(Box, {\n              display: \"flex\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsx(Switch, {}), /*#__PURE__*/_jsxs(Typography, {\n                variant: \"button\",\n                style: {\n                  fontWeight: \"regular\",\n                  cursor: \"pointer\",\n                  userSelect: \"none\"\n                } // onClick={handleSetRememberMe}\n                // sx={{ cursor: \"pointer\", userSelect: \"none\" }}\n                ,\n                children: [\"\\xA0\\xA0\", translate(\"Remember me\")]\n              })]\n            }), /*#__PURE__*/_jsx(Box, {\n              mt: 4,\n              mb: 1,\n              children: isSubmitting ? /*#__PURE__*/_jsx(SuiButton, {\n                disabled: true,\n                variant: \"gradient\",\n                color: \"info\",\n                fullWidth: true,\n                children: translate(\"Signing in...\")\n              }) : /*#__PURE__*/_jsx(SuiButton, {\n                disabled: !(dirty && isValid),\n                type: \"submit\",\n                variant: \"gradient\",\n                color: \"info\",\n                fullWidth: true,\n                children: translate(\"Sign in\")\n              })\n            })]\n          });\n        }\n      })\n    })\n  });\n}\n\nexport default SignIn;","map":null,"metadata":{},"sourceType":"module"}